# koa-git-pull

本项目只适用于那些 小的、不正规的 前端开发团队。

对于那些拥有标准开发流程规范的团队，本项目可能只是一个笑话。



<br>

**适用场景：**

1. 假定某前端项目由若干成员一块通过 git 开发提交代码
2. 出于某种原因真正的 git 代码服务器上并没有添加 git 代码自动部署
3. 而开发过程中又想看到效果，那么这个时候可以在某台电脑上自己搭建一个静态文件服务
4. 这个静态文件服务可以是由 nginx 或 http-server 来创建，静态文件为前端项目打包构建(build)后的内容
5. **这里就存在一个问题：** 前端开发成员提交 git 代码后，还需要远程连接到提供静态文件服务的那台电脑，然后依次执行：`git pull`、`yarn build`...
6. 这里的 “远程连接” 实际中可能并不方便，甚至很有可能是通过 聊天软件 告诉同事：我刚提交代码，你帮我在那台电脑上拉取打包一下
7. 所以... 可能会需要用到本项目了



<br>

**项目简介：**

1. 使用 Koa 创建一个本地 http 服务，默认启用端口为 8001
2. 添加有 3 个路由：
   * `/`：get方式，默认页
   * `/pull`：post方式，请求拉取代码，然后执行构建
   * `/force-pull`：post方式，请求拉取代码，并且重新安装各个 npm 包，最后再执行构建
3. 在 `/pull`、`/force-pull` 2个路由中会通过 node 执行我们设定好的一些 .bat 脚本，在这些脚本中会执行：git pull、yarn、yarn build ... 等
4.  `pull.bat` 和 `force-pull.bat`中，假定你 git 的项目目录位于：`e:\workspace\my-project`，你可根据实际情况修改该目录
5. `start.bat` 中，假定你本项目目录位于：`e:\koa\kao-git-pull`，你可根据实际情况修改该目录



<br>

总之，通过本项目所创建的服务，可以让前端团队各个成员，在不远程连接电脑情况下，直接通过访问该电脑所提供的本项目 http 服务来达到代码拉取和构建。



<img src="https://raw.githubusercontent.com/puxiao/koa-git-pull/main/snapshot.jpg" alt="snapshot" style="zoom:60%;" />



<br>

**温馨提醒：只把本项目部署到局域网即可，不要允许外网访问**

> 你总不会想允许任何人都可以去请求执行这些吧。



<br>

**补充说明：**

1. 为了避免频繁执行拉取，所以项目代码中设置了默认 3 分钟的时间间隔

   > 如果你的项目比较大，构建时间超过 3 分钟，那么你可以把时间改成更大一些

2. 本项目中的 koa 进程服务由 pm2 守护，以确保可以一直运行

3. 可以把本项目的 `start.bat` 文件加入到系统开机启动计划任务中，这样每次开机就可以自动运行

   具体做法为：

   * 开始 > 运行 > 输入 `shell:startup`
   * 在窗口中，将 `start.bat` 文件的 快捷方式图标 拖入进来
   
4. 本项目只负责提供 git 拉取和构建，至于构建(build)好后的文件服务，你还是自己使用 nginx 或 http-server 创建吧



<br>

**运行环境：windows系统**

本代码只在 windows10 上实际运行过，调用的脚本 `xx.bat` 并不适用于其他操作系统。

> 可根据实际情况修改成其他操作系统中 node 支持运行脚本即可。

